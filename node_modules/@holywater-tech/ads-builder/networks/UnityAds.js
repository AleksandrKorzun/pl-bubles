/* global window */

import Network from './Network';

export default class UnityAds extends Network {
    constructor(callback) {
        
        super();
        this.callback = callback;
        this.onDapiReadyCallbackBind = this.onDapiReadyCallback.bind(this);
        window.mraid.getState() === 'loading' ? window.mraid.addEventListener('ready', this.onDapiReadyCallbackBind) : this.onDapiReadyCallback();
    }

    onDapiReadyCallback() {
        window.mraid.removeEventListener('ready', this.onDapiReadyCallbackBind);


        if (window.mraid.isViewable()) {
            setTimeout(() => {
                this.callback();
            }, 500);
        } else {
            window.mraid.addEventListener('viewableChange', () => {
                setTimeout(() => {
                    this.callback();
                }, 500);
            });
        }

        window.mraid.addEventListener('sizeChange', () => {
            this.game.resize();
        });


    }

    openStore() {
        window.mraid ? window.mraid.open(this.getUrl()) : window.top.open(this.getUrl());
    }
}
